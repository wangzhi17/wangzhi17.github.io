<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"/>
    <title>海底捞地排风远程管理控制React版本测试</title>
    <script src="./js/react_16.4.0_dev.js"></script>
    <script src="./js/react-dom_16.4.0_dev.js"></script>
    <script src="./js/babel_6.26.0.js"></script>
</head>
<body>

<div id="hdl"></div>
<script type="text/jsx">
    let webSocket = null;

    class WebsocketClient extends React.Component {
        constructor(props) {
            super(props);
            let dJSON = JSON.stringify({
                "code": "0000",
                "data": {
                    "storeInfo": {"storeID": "86-10-35"},
                    "group": [{
                        "groupName": "#1地排风",
                        "tableInfo": [{
                            "tableName": "001",
                            "fireStatus": "1",
                            "setOpenPercent": "76",
                            "currentOpenPercent": "76",
                            "airValve": "75%",
                            "controllerMode": "自动模式"
                        }, {
                            "tableName": "002",
                            "fireStatus": "0",
                            "setOpenPercent": "0",
                            "currentOpenPercent": "0",
                            "controllerMode": "自动模式"
                        }],
                        "inverter": {"inverterName": "#1变频器", "setFrequency": "40Hz", "currentFrequency": "40Hz"}
                    }, {
                        "groupName": "#2地排风",
                        "tableInfo": [{
                            "tableName": "003",
                            "fireStatus": "0",
                            "setOpenPercent": "0",
                            "currentOpenPercent": "0",
                            "controllerMode": "自动模式"
                        }, {
                            "tableName": "004",
                            "fireStatus": "1",
                            "setOpenPercent": "76",
                            "currentOpenPercent": "76",
                            "controllerMode": "自动模式"
                        }],
                        "inverter": {"inverterName": "#2变频器", "setFrequency": "30Hz", "currentFrequency": "30Hz"}
                    }]
                }
            });
            this.state = {
                socketMessage: JSON.parse(dJSON),
                selectedGroupName: ""
            };
        }

        componentDidMount() {

            // webSocket=new WebSocket("ws://echo.websocket.org/");
            // webSocket.onopen=function () {
            //     console.log('连接成功')
            // };
            // webSocket.onmessage=function (ev) {
            //     console.log(ev.data)
            // };
            // webSocket.onclose=function () {
            //     console.log('连接关闭')
            // };
            //
            // window.onbeforeunload=function () {
            //     webSocket.close();
            // }
            //this.timerID = setInterval(() => this.tick(),1);
        }

        componentWillUnmount() {
            //clearInterval(this.timerID);
        }

        selectGroupName = (groupName) => {
            this.setState({
                selectedGroupName: groupName
            })
        };

        render() {
            return (
                <div>
                    <h1>代码：{this.state.socketMessage.code}</h1>
                    <h1>门店代码：{this.state.socketMessage.data.storeInfo.storeID}</h1>
                    <div style={{display: 'flex', flexDirection: 'row'}}>
                        {
                            this.state.socketMessage.data.group.map((groups, index) => {
                                let groupName = groups.groupName;
                                return (
                                    <div key={index}>
                                        <button style={this.state.selectedGroupName === groupName ? {
                                            fontSize: 20,
                                            color: 'red',
                                            marginRight: 10,
                                            backgroundColor: '#FFFFFF'
                                        } : {fontSize: 20, color: 'black', marginRight: 10}}
                                                onClick={() => this.selectGroupName(groupName)}>
                                            {groupName}
                                        </button>

                                    </div>
                                )
                            })
                        }
                    </div>
                    {
                        this.state.socketMessage.data.group.map((groups, index) => {
                            if (groups.groupName === this.state.selectedGroupName) {
                                let tableInfo = groups.tableInfo;
                                let inverter = groups.inverter;
                                let inverterName = inverter.inverterName;
                                let setFrequency = inverter.setFrequency;
                                let currentFrequency = inverter.currentFrequency;
                                console.log(`group:${index}`);
                                return (
                                    <div key={index} style={{display: 'flex', flexDirection: 'row'}}>
                                        {
                                            tableInfo.map((tableInfos, i) => {

                                                let tableName = tableInfos.tableName;
                                                let fireStatus = tableInfos.fireStatus;
                                                let setOpenPercent = tableInfos.setOpenPercent;
                                                let currentOpenPercent = tableInfos.currentOpenPercent;
                                                let controllerMode = tableInfos.controllerMode;
                                                return (
                                                    <div key={i} style={{marginRight: 20}}>
                                                        <h2>餐桌号：{tableName}</h2>
                                                        <h2>点火状态：{fireStatus === '0' ? '关闭' : '开启'}</h2>
                                                        <h2>设置角度：{setOpenPercent}</h2>
                                                        <h2>当前角度：{currentOpenPercent}</h2>
                                                        <h2>模式：{controllerMode}</h2>
                                                    </div>
                                                )
                                            })
                                        }
                                        <div style={{display:'flex',flexDirection:'column'}}>
                                            <h2>变频器名称：{inverterName}</h2>
                                            <h2>设置频率：{setFrequency}</h2>
                                            <h2>当前频率：{currentFrequency}</h2>
                                        </div>
                                    </div>
                                )
                            }
                        })}
                </div>
            );
        }
    }

    ReactDOM.render(
        <WebsocketClient/>,
        document.getElementById('hdl')
    );
</script>

</body>
</html>